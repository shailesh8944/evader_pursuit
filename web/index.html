<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marine Vessel CAD Configurator</title>
    
    <!-- Bootstrap CSS and Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Three.js and related libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/inflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/fflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/TGALoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/stats.min.js"></script>
    
    <!-- Other dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.5/split.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Main application container with CAD-like layout -->
    <div class="cad-container">
        <!-- Top toolbar with main actions -->
        <div class="toolbar" id="main-toolbar">
            <div class="app-title">
                <i class="bi bi-water"></i> Marine Vessel Configurator
            </div>
            <div class="toolbar-items">
                <button class="toolbar-btn" id="btn-new-vessel" title="New vessel">
                    <i class="bi bi-file-earmark-plus"></i>
                </button>
                <button class="toolbar-btn" id="btn-load-vessel" title="Load vessel">
                    <i class="bi bi-folder2-open"></i>
                </button>
                <button class="toolbar-btn" id="btn-save-vessel" title="Save vessel">
                    <i class="bi bi-save"></i>
                </button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="btn-undo" title="Undo">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </button>
                <button class="toolbar-btn" id="btn-redo" title="Redo">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
                <div class="toolbar-divider"></div>
                <button class="toolbar-btn" id="btn-generate-yaml" title="Generate YAML files">
                    <i class="bi bi-file-earmark-code"></i> Generate YAML
                </button>
            </div>
        </div>
        
        <!-- Main content area with sidebars and 3D view -->
        <div class="main-content">
            <!-- Left sidebar with project explorer, properties, etc. -->
            <div class="left-sidebar" id="left-sidebar">
                <div class="sidebar-tabs">
                    <div class="sidebar-tab active" data-tab="project-tab">
                        <i class="bi bi-kanban"></i> Project
                    </div>
                    <div class="sidebar-tab" data-tab="properties-tab">
                        <i class="bi bi-gear"></i> Properties
                    </div>
                </div>
                
                <!-- Project tab content -->
                <div class="sidebar-content active" id="project-tab">
                    <div class="panel vessel-info-panel">
                        <div class="panel-header">
                            <h5>Vessel Information</h5>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="vesselName">Name</label>
                                <input type="text" class="form-control" id="vesselName" placeholder="Enter vessel name">
                            </div>
                            <div class="form-group">
                                <label for="vesselType">Type</label>
                                <select class="form-control" id="vesselType">
                                    <option value="auv">AUV</option>
                                    <option value="usv">USV</option>
                                    <option value="ship">Ship</option>
                                    <option value="rov">ROV</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel hierarchy-panel">
                        <div class="panel-header">
                            <h5>Hierarchy</h5>
                            <div class="panel-actions">
                                <button class="btn-icon" id="expandAll" title="Expand all">
                                    <i class="bi bi-arrows-expand"></i>
                                </button>
                                <button class="btn-icon" id="collapseAll" title="Collapse all">
                                    <i class="bi bi-arrows-collapse"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div id="scene-hierarchy" class="hierarchy-tree">
                                <!-- Hierarchy items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Properties tab content -->
                <div class="sidebar-content" id="properties-tab">
                    <div class="panel properties-panel">
                        <div class="panel-header">
                            <h5>Object Properties</h5>
                        </div>
                        <div class="panel-body" id="object-properties">
                            <div class="no-selection-message">
                                Select an object to view its properties
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main 3D viewport -->
            <div class="viewport" id="viewer3D">
                <!-- 3D viewport will be rendered here -->
                <div class="viewport-overlay">
                    <div class="viewport-tools">
                        <button class="viewport-btn" id="btn-translate" title="Translate (G)">
                            <i class="bi bi-arrows-move"></i>
                        </button>
                        <button class="viewport-btn" id="btn-rotate" title="Rotate (R)">
                            <i class="bi bi-arrow-repeat"></i>
                        </button>
                        <button class="viewport-btn" id="btn-scale" title="Scale (S)">
                            <i class="bi bi-arrows-angle-expand"></i>
                        </button>
                        <div class="viewport-tools-divider"></div>
                        <button class="viewport-btn" id="btn-toggle-grid" title="Toggle Grid">
                            <i class="bi bi-grid-3x3"></i>
                        </button>
                        <button class="viewport-btn" id="btn-toggle-wireframe" title="Toggle Wireframe">
                            <i class="bi bi-bounding-box"></i>
                        </button>
                        <button class="viewport-btn" id="btn-center-view" title="Center View">
                            <i class="bi bi-fullscreen"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right sidebar with component library, simulation settings -->
            <div class="right-sidebar" id="right-sidebar">
                <div class="sidebar-tabs">
                    <div class="sidebar-tab active" data-tab="components-tab">
                        <i class="bi bi-box"></i> Components
                    </div>
                    <div class="sidebar-tab" data-tab="simulation-tab">
                        <i class="bi bi-sliders"></i> Simulation
                    </div>
                </div>
                
                <!-- Components tab content -->
                <div class="sidebar-content active" id="components-tab">
                    <div class="panel component-panel">
                        <div class="panel-header">
                            <h5>Model Files</h5>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label>3D Model</label>
                                <div class="file-input-group">
                                    <input type="file" class="form-control" id="fbxFile" accept=".fbx,.stl,.obj,.gltf">
                                    <small class="text-muted">Load FBX, STL, OBJ, or GLTF file</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>GDF File</label>
                                <div class="file-input-group">
                                    <input type="file" class="form-control" id="gdfFile" accept=".gdf">
                                    <small class="text-muted">Load GDF file for hydrodynamics</small>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Hydra Output</label>
                                <div class="file-input-group">
                                    <input type="file" class="form-control" id="hydraZip" accept=".zip">
                                    <small class="text-muted">Load Hydra output zip file</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel component-panel">
                        <div class="panel-header">
                            <h5>Add Components</h5>
                        </div>
                        <div class="panel-body">
                            <div class="component-buttons">
                                <button class="component-btn" id="btn-add-control-surface">
                                    <i class="bi bi-box"></i>
                                    <span>Control Surface</span>
                                </button>
                                <button class="component-btn" id="btn-add-thruster">
                                    <i class="bi bi-circle"></i>
                                    <span>Thruster</span>
                                </button>
                                <button class="component-btn" id="btn-add-sensor">
                                    <i class="bi bi-cpu"></i>
                                    <span>Sensor</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Simulation tab content -->
                <div class="sidebar-content" id="simulation-tab">
                    <div class="panel simulation-panel">
                        <div class="panel-header">
                            <h5>Simulation Settings</h5>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="simTime">Simulation Time (s)</label>
                                <input type="number" class="form-control" id="simTime" value="100" min="0">
                            </div>
                            <div class="form-group">
                                <label for="timeStep">Time Step (s)</label>
                                <input type="number" class="form-control" id="timeStep" value="0.01" min="0.001" step="0.001">
                            </div>
                            <div class="form-group">
                                <label for="density">Water Density (kg/m³)</label>
                                <input type="number" class="form-control" id="density" value="1025" min="0">
                            </div>
                            <div class="form-group">
                                <label for="gravity">Gravity (m/s²)</label>
                                <input type="number" class="form-control" id="gravity" value="9.80665" step="0.00001">
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel simulation-panel">
                        <div class="panel-header">
                            <h5>World Settings</h5>
                        </div>
                        <div class="panel-body">
                            <div class="form-group">
                                <label>World Size (m)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="worldSizeX" placeholder="X" value="1000">
                                    <input type="number" class="form-control" id="worldSizeY" placeholder="Y" value="1000">
                                    <input type="number" class="form-control" id="worldSizeZ" placeholder="Z" value="100">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>GPS Datum [lat, lon, alt]</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="gpsDatumLat" placeholder="Lat" value="12.99300">
                                    <input type="number" class="form-control" id="gpsDatumLon" placeholder="Lon" value="80.23913">
                                    <input type="number" class="form-control" id="gpsDatumAlt" placeholder="Alt" value="-87.0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for adding control surface -->
    <div class="modal fade" id="controlSurfaceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Control Surface</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="controlSurfaceType">Type</label>
                        <select class="form-control" id="controlSurfaceType">
                            <option value="Rudder">Rudder</option>
                            <option value="Fins">Fins</option>
                            <option value="Elevator">Elevator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Position [x, y, z]</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="csPositionX" value="0" step="0.1">
                            <input type="number" class="form-control" id="csPositionY" value="0" step="0.1">
                            <input type="number" class="form-control" id="csPositionZ" value="0" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Orientation [roll, pitch, yaw] (degrees)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="csOrientationX" value="0" step="1">
                            <input type="number" class="form-control" id="csOrientationY" value="0" step="1">
                            <input type="number" class="form-control" id="csOrientationZ" value="0" step="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="csArea">Area (m²)</label>
                        <input type="number" class="form-control" id="csArea" value="0.1" min="0.01" step="0.01">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnAddControlSurface">Add</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for adding thruster -->
    <div class="modal fade" id="thrusterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Thruster</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="thrusterType">Type</label>
                        <select class="form-control" id="thrusterType">
                            <option value="Propeller">Propeller</option>
                            <option value="Jet">Jet</option>
                            <option value="Tunnel">Tunnel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Position [x, y, z]</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="thrusterPositionX" value="0" step="0.1">
                            <input type="number" class="form-control" id="thrusterPositionY" value="0" step="0.1">
                            <input type="number" class="form-control" id="thrusterPositionZ" value="0" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Orientation [roll, pitch, yaw] (degrees)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="thrusterOrientationX" value="0" step="1">
                            <input type="number" class="form-control" id="thrusterOrientationY" value="0" step="1">
                            <input type="number" class="form-control" id="thrusterOrientationZ" value="0" step="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="thrusterDiameter">Propeller Diameter (m)</label>
                        <input type="number" class="form-control" id="thrusterDiameter" value="0.2" min="0.01" step="0.01">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnAddThruster">Add</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for adding sensor -->
    <div class="modal fade" id="sensorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Sensor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="sensorType">Type</label>
                        <select class="form-control" id="sensorType">
                            <option value="IMU">IMU</option>
                            <option value="GPS">GPS</option>
                            <option value="DVL">DVL</option>
                            <option value="Depth">Depth</option>
                            <option value="Camera">Camera</option>
                            <option value="Sonar">Sonar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Position [x, y, z]</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="sensorPositionX" value="0" step="0.1">
                            <input type="number" class="form-control" id="sensorPositionY" value="0" step="0.1">
                            <input type="number" class="form-control" id="sensorPositionZ" value="0" step="0.1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Orientation [roll, pitch, yaw] (degrees)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="sensorOrientationX" value="0" step="1">
                            <input type="number" class="form-control" id="sensorOrientationY" value="0" step="1">
                            <input type="number" class="form-control" id="sensorOrientationZ" value="0" step="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sensorPublishRate">Publish Rate (Hz)</label>
                        <input type="number" class="form-control" id="sensorPublishRate" value="10" min="0.1" step="0.1">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnAddSensor">Add</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for component details when selecting in the FBX model -->
    <div class="modal fade" id="fbxComponentModal" tabindex="-1" role="dialog" aria-labelledby="fbxComponentModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fbxComponentModalLabel">Configure Component</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="fbxComponentType" value="">
                    
                    <!-- Control Surface Settings -->
                    <div id="fbxControlSurfaceSettings" style="display: none;">
                        <div class="mb-3">
                            <label for="fbxSurfaceType" class="form-label">Surface Type</label>
                            <select class="form-select" id="fbxSurfaceType">
                                <option value="Rudder">Rudder</option>
                                <option value="Fin">Fin</option>
                                <option value="Elevator">Elevator</option>
                                <option value="Aileron">Aileron</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fbxSurfaceName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="fbxSurfaceName">
                        </div>
                        <div class="mb-3">
                            <label for="fbxSurfaceMaxAngle" class="form-label">Max Angle (degrees)</label>
                            <input type="number" class="form-control" id="fbxSurfaceMaxAngle" value="30" min="0" max="90">
                        </div>
                    </div>
                    
                    <!-- Thruster Settings -->
                    <div id="fbxThrusterSettings" style="display: none;">
                        <div class="mb-3">
                            <label for="fbxThrusterType" class="form-label">Thruster Type</label>
                            <select class="form-select" id="fbxThrusterType">
                                <option value="Propeller">Propeller</option>
                                <option value="Tunnel">Tunnel</option>
                                <option value="Vectored">Vectored</option>
                                <option value="Jet">Jet</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fbxThrusterName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="fbxThrusterName">
                        </div>
                        <div class="mb-3">
                            <label for="fbxThrusterMaxThrust" class="form-label">Max Thrust (N)</label>
                            <input type="number" class="form-control" id="fbxThrusterMaxThrust" value="1000" min="0" step="100">
                        </div>
                    </div>
                    
                    <!-- Sensor Settings -->
                    <div id="fbxSensorSettings" style="display: none;">
                        <div class="mb-3">
                            <label for="fbxSensorType" class="form-label">Sensor Type</label>
                            <select class="form-select" id="fbxSensorType">
                                <option value="IMU">IMU</option>
                                <option value="GPS">GPS</option>
                                <option value="DVL">DVL</option>
                                <option value="Pressure">Pressure Sensor</option>
                                <option value="Camera">Camera</option>
                                <option value="Sonar">Sonar</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fbxSensorName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="fbxSensorName">
                        </div>
                        <div class="mb-3">
                            <label for="fbxSensorRate" class="form-label">Update Rate (Hz)</label>
                            <input type="number" class="form-control" id="fbxSensorRate" value="50" min="1" max="1000">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnApplyFbxComponent">Apply</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for YAML generation -->
    <div class="modal fade" id="yamlModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Generate YAML Files</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="outputPath">Output Directory Path</label>
                        <input type="text" class="form-control" id="outputPath" value="/workspaces/mavlab/inputs/">
                        <small class="text-muted">Files will be generated in [path]/[vessel-name]/</small>
                    </div>
                    <div class="yaml-preview-tabs">
                        <ul class="nav nav-tabs" id="yamlTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="simulation-tab" data-bs-toggle="tab" data-bs-target="#simulation-yaml" type="button" role="tab" aria-selected="true">simulation_input.yml</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="geometry-tab" data-bs-toggle="tab" data-bs-target="#geometry-yaml" type="button" role="tab" aria-selected="false">geometry.yml</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="inertia-tab" data-bs-toggle="tab" data-bs-target="#inertia-yaml" type="button" role="tab" aria-selected="false">inertia.yml</button>
                            </li>
                            <!-- Add more tabs as needed -->
                        </ul>
                        <div class="tab-content" id="yamlTabContent">
                            <div class="tab-pane fade show active" id="simulation-yaml" role="tabpanel">
                                <pre class="yaml-preview" id="simulation-yaml-content"></pre>
                            </div>
                            <div class="tab-pane fade" id="geometry-yaml" role="tabpanel">
                                <pre class="yaml-preview" id="geometry-yaml-content"></pre>
                            </div>
                            <div class="tab-pane fade" id="inertia-yaml" role="tabpanel">
                                <pre class="yaml-preview" id="inertia-yaml-content"></pre>
                            </div>
                            <!-- Add more content panes as needed -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnDownloadZip">Download as ZIP</button>
                    <button type="button" class="btn btn-success" id="btnGenerateYaml">Generate YAML</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="js/vessel-model.js"></script>
    <script src="js/yaml-generator.js"></script>
    <script src="js/gdf-loader.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/three-setup.js"></script>
    <script src="js/main.js"></script>
</body>
</html> 