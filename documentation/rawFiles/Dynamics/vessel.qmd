# Vessel Module

## Overview

The Vessel module (`class_vessel.py`) is the core component of the MAV simulator. It provides a comprehensive representation of marine vessel dynamics with complete 6-DOF (Degrees of Freedom) modeling.

::: {.callout-note}
This module serves as the foundation of the entire simulation environment, handling vessel state, forces, and dynamics.
:::

## Class Structure

```{mermaid}
classDiagram
    class Vessel {
        +float g
        +float rho
        +float L, B, D
        +float U
        +float mass
        +numpy.ndarray CG
        +numpy.ndarray mass_matrix
        +numpy.ndarray added_mass_matrix
        +__init__(vessel_params, hydrodynamic_data, vessel_id, ros_flag)
        +vessel_ode(t, state)
        +hydrodynamic_forces(vel)
        +control_forces(delta, stall_angle, Cl, Cd)
        +thruster_forces(n_prop)
        +step()
        +reset()
        +simulate()
        +gravitational_forces(phi, theta)
        +calculate_coriolis_matrices(vel)
        -_dimensionalize_coefficients(rho, L, U)
    }
```

## Key Attributes

| Attribute           | Type             | Description                                        |
|---------------------|------------------|----------------------------------------------------|
| `g`                 | float            | Gravitational acceleration                         |
| `rho`               | float            | Water density                                      |
| `L`, `B`, `D`       | float            | Length, breadth, and depth of the vessel          |
| `mass`              | float            | Vessel mass                                        |
| `CG`                | numpy.ndarray    | Center of gravity coordinates                      |
| `mass_matrix`       | numpy.ndarray    | Rigid body mass matrix                            |
| `added_mass_matrix` | numpy.ndarray    | Added mass coefficients from hydrodynamic analysis |

## Main Methods

### Initialization

```python
def __init__(self, vessel_params: Dict, hydrodynamic_data: Dict, vessel_id: int, ros_flag: bool = True):
```

The constructor initializes the vessel with parameters and hydrodynamic data. It sets up:

- Basic vessel parameters (dimensions, mass, etc.)
- Inertia properties
- Hydrodynamic coefficients
- Initial state

### Dynamic Model

```python
def vessel_ode(self, t, state):
```

This method implements the vessel's equations of motion as a system of first-order ordinary differential equations (ODEs). It computes:

1. Rigid body forces
2. Hydrodynamic forces
3. Control forces (rudder, thruster)
4. Environmental forces
5. State derivatives for integration

### Force Components

The vessel's total forces are composed of several components:

- **Hydrodynamic Forces**: `hydrodynamic_forces(vel)` - Computes forces from added mass, damping, and other hydrodynamic effects
- **Control Forces**: `control_forces(delta, stall_angle, Cl, Cd)` - Calculates forces from control surfaces like rudders
- **Thruster Forces**: `thruster_forces(n_prop)` - Determines propulsion forces
- **Gravitational Forces**: `gravitational_forces(phi, theta)` - Handles weight and buoyancy

### Simulation Methods

- **Step**: `step()` - Advances the simulation by one time step
- **Reset**: `reset()` - Resets the vessel to its initial state
- **Simulate**: `simulate()` - Runs a complete simulation

## Usage Example

```python
# Example of creating and using a vessel
import numpy as np
from mav_simulator.class_vessel import Vessel

# Define vessel parameters
vessel_params = {
    'name': 'USV1',
    'gravity': 9.81,
    'density': 1025.0,
    'geometry': {
        'length': 5.0,
        'breadth': 2.0,
        'depth': 1.0,
        'CG': np.array([0.0, 0.0, 0.0]),
        'CB': np.array([0.0, 0.0, 0.1]),
        'gyration': np.array([0.4, 0.4, 0.2])
    },
    'inertia': {
        'mass': 1000.0,
        'buoyancy_mass': 1000.0,
        'inertia_matrix': "None",
        'added_mass_matrix': "None"
    },
    'gps_datum': [0.0, 0.0]
}

# Define hydrodynamic data
hydro_data = {
    'hydra_file': 'path/to/hydra_file.json',
    'dim_flag': True
}

# Create vessel
vessel = Vessel(vessel_params, hydro_data, vessel_id=1)

# Run simulation
vessel.simulate()
```

## Integration with Other Modules

The Vessel class interacts with several other modules:

- **Kinematics Module**: For coordinate transformations and attitude representation
- **Control Module**: For implementing control algorithms
- **Hydrodynamics Calculation**: For computing vessel-specific hydrodynamic coefficients

## Customization

The Vessel class can be extended or customized by:

1. Modifying vessel parameters in the configuration dictionary
2. Subclassing to implement specialized vessel types
3. Implementing custom force components for specific simulation scenarios 