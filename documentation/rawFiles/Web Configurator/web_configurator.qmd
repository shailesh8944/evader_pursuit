# Web Configurator

## Overview

The MAV Simulator Web Configurator is an interactive web-based tool for configuring and visualizing marine autonomous vehicles. It provides a user-friendly interface for:

- 3D vessel visualization
- Parameter configuration
- YAML file generation
- Real-time preview of vessel properties

## Architecture

The web configurator is built using:

- Three.js for 3D visualization
- YAML.js for YAML file handling
- Custom JavaScript modules for vessel modeling and controls

### Core Components

```{mermaid}
graph TD
    A[Web Interface] --> B[3D Visualization]
    A --> C[Parameter Forms]
    A --> D[YAML Generator]
    
    B --> E[Three.js Setup]
    B --> F[Vessel Model]
    B --> G[Controls]
    
    C --> H[Form Validation]
    C --> I[Real-time Updates]
    
    D --> J[YAML.js]
    D --> K[File Export]
```

## Directory Structure

```
web/
├── index.html          # Main HTML file
├── styles.css          # Global styles
├── themes.css          # Theme definitions
├── css/
│   └── style.css      # Additional styles
└── js/
    ├── main.js        # Main application logic
    ├── three-setup.js # Three.js initialization
    ├── vessel-model.js # Vessel 3D model
    ├── yaml-generator.js # YAML file handling
    ├── gdf-loader.js  # GDF file loading
    └── controls.js    # UI controls
```

## Core Components and Functions

### Main Application (`main.js`)

The main application orchestrates all components and handles the application lifecycle.

#### Classes

`ConfiguratorApp`: Main application class that initializes and coordinates all components.

#### Functions

`ConfiguratorApp.constructor()`  
Creates instances of required components and prepares the application.

`ConfiguratorApp.initialize()`  
Sets up the Three.js scene, loads the default vessel model, and configures event listeners.

`ConfiguratorApp.setupEventListeners()`  
Registers event handlers for form changes and file operations.

`ConfiguratorApp.handleParameterChange(event)`  
Processes parameter changes from the UI forms and updates the vessel model.

`ConfiguratorApp.handleImport()`  
Handles YAML file import operations, parsing configurations and applying them to the model.

`ConfiguratorApp.handleExport()`  
Generates YAML files from current parameters and initiates download.

`ConfiguratorApp.animate()`  
Manages the animation loop for continuous rendering of the 3D scene.

### Three.js Setup (`three-setup.js`)

Manages the 3D visualization environment using Three.js.

#### Classes

`ThreeViewer`: Encapsulates Three.js scene, camera, and renderer setup.

#### Functions

`ThreeViewer.constructor()`  
Initializes Three.js objects including scene, camera, and renderer.

`ThreeViewer.setup()`  
Configures the renderer, camera position, lighting, and orbit controls.

`ThreeViewer.updateViewportSize(width, height)`  
Updates the viewport size when the browser window is resized.

`ThreeViewer.render()`  
Renders the current state of the 3D scene to the canvas.

`ThreeViewer.addObject(object)`  
Adds a 3D object to the scene with proper positioning.

`ThreeViewer.removeObject(object)`  
Removes a 3D object from the scene.

`ThreeViewer.getCameraPosition()`  
Returns the current camera position for state saving.

`ThreeViewer.setCameraPosition(position, target)`  
Sets the camera position and target for view restoration.

### Vessel Model (`vessel-model.js`)

Manages the 3D representation of the vessel and its properties.

#### Classes

`VesselModel`: Handles vessel geometry, materials, and parameter updates.

#### Functions

`VesselModel.constructor()`  
Initializes vessel properties and default values.

`VesselModel.loadDefault()`  
Loads the default vessel geometry and materials.

`VesselModel.loadGeometry(file)`  
Loads vessel geometry from a GDF file using the GDFLoader.

`VesselModel.setupMaterials()`  
Creates and configures materials for different parts of the vessel.

`VesselModel.createMesh()`  
Generates the 3D mesh from loaded geometry and materials.

`VesselModel.updateParameter(name, value)`  
Updates a specific parameter value and triggers visualization updates.

`VesselModel.updateVisualization()`  
Updates the 3D visualization based on current parameters.

`VesselModel.getParameters()`  
Returns all current vessel parameters for export or saving.

`VesselModel.setParameters(params)`  
Sets multiple parameters at once for import operations.

`VesselModel.updateControlSurfaces(surfaces)`  
Updates control surface positions, angles, and dimensions.

`VesselModel.updateThrusters(thrusters)`  
Updates thruster positions, orientations, and properties.

### YAML Generator (`yaml-generator.js`)

Handles configuration file generation and validation.

#### Classes

`YAMLGenerator`: Manages YAML generation, validation, and file operations.

#### Functions

`YAMLGenerator.constructor()`  
Initializes the YAML generator with required libraries.

`YAMLGenerator.generateYAML(parameters)`  
Creates a valid YAML string from the provided parameters.

`YAMLGenerator.validateYAML(yamlString)`  
Validates YAML syntax and structure.

`YAMLGenerator.validateConfig(config)`  
Validates configuration values against required fields and constraints.

`YAMLGenerator.exportToFile(yaml, filename)`  
Exports the generated YAML to a downloadable file.

`YAMLGenerator.importFromFile(file, callback)`  
Imports and parses a YAML file, providing the results to a callback.

`YAMLGenerator.parseYAML(yamlString)`  
Parses a YAML string into a JavaScript object.

`YAMLGenerator.convertToParameters(config)`  
Converts a configuration object to parameters usable by the application.

### GDF Loader (`gdf-loader.js`)

Specialized loader for vessel geometry files.

#### Classes

`GDFLoader`: Loads and parses GDF format files into Three.js geometries.

#### Functions

`GDFLoader.constructor()`  
Initializes the loader with a Three.js loading manager.

`GDFLoader.load(url, onLoad, onProgress, onError)`  
Loads a GDF file from the provided URL with appropriate callbacks.

`GDFLoader.parse(text)`  
Parses GDF format text into Three.js geometry.

`GDFLoader.parseVertex(line)`  
Parses a vertex definition line into a Three.js Vector3.

`GDFLoader.parseFace(line)`  
Parses a face definition line into vertex indices.

`GDFLoader.createGeometry(vertices, faces)`  
Creates a Three.js BufferGeometry from parsed vertices and faces.

`GDFLoader.computeNormals(geometry)`  
Computes face and vertex normals for proper lighting.

### Controls (`controls.js`)

Manages user interface interactions and form handling.

#### Classes

`Controls`: Handles UI controls, forms, and user input.

#### Functions

`Controls.constructor()`  
Initializes form references and event listeners.

`Controls.setupForms()`  
Sets up form references and default values.

`Controls.setupEventListeners()`  
Registers event handlers for form inputs and submissions.

`Controls.validateForm(event)`  
Validates form data against constraints before submission.

`Controls.validateData(data)`  
Checks specific data fields for valid values and formats.

`Controls.handleChange(event)`  
Processes input changes and triggers updates to the preview.

`Controls.updatePreview(name, value)`  
Dispatches parameter change events for visualization updates.

`Controls.submitForm(data)`  
Processes validated form data for application use.

`Controls.resetForm(formId)`  
Resets a form to default values.

`Controls.populateForm(formId, data)`  
Populates a form with values from loaded data.

`Controls.setupTooltips()`  
Initializes tooltips for form elements to provide help.

`Controls.setupRangeSliders()`  
Configures range sliders with appropriate min/max values and steps.

## Features

### 3D Visualization

The configurator provides interactive 3D visualization of the vessel:

- Real-time model updates
- Multiple view angles
- Zoom and pan controls
- Material and texture support

### Parameter Configuration

The interface allows configuration of various vessel parameters:

- Geometry and dimensions
- Mass and inertia properties
- Hydrodynamic coefficients
- Control surfaces
- Sensors and actuators

### YAML Generation

The configurator generates YAML configuration files for the simulator:

- Complete vessel configuration
- Parameter validation
- File export functionality
- Configuration templates

## Usage

### Starting the Configurator

1. Open `index.html` in a modern web browser
2. The 3D viewer will load with the default vessel model
3. Use the parameter forms to configure the vessel
4. Preview changes in real-time in the 3D viewer
5. Generate and download YAML configuration files

### Navigation Controls

- Left mouse button: Rotate view
- Right mouse button: Pan view
- Mouse wheel: Zoom in/out
- Reset button: Return to default view

### Parameter Forms

The interface provides forms for configuring:

1. **Geometry**
   - Length, breadth, depth
   - Control surface positions
   - Thruster locations

2. **Inertia Properties**
   - Mass
   - Center of gravity
   - Inertia matrix

3. **Hydrodynamics**
   - Added mass coefficients
   - Damping coefficients
   - Restoring forces

4. **Sensors and Actuators**
   - Sensor types and positions
   - Actuator configurations
   - Control surface properties

### File Operations

- **Import**: Load existing YAML configurations
- **Export**: Generate and download YAML files
- **Save**: Store current configuration
- **Reset**: Return to default settings

## Development

### Adding New Features

1. Create new JavaScript modules in the `js` directory
2. Add corresponding UI elements in `index.html`
3. Update styles in `styles.css` or `css/style.css`
4. Test the new functionality

### Customizing the Interface

The interface can be customized by modifying:

- `themes.css` for color schemes
- `css/style.css` for layout and components
- `js/controls.js` for interaction behavior

### Browser Support

The configurator is tested and supported on:

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

## Troubleshooting

### Common Issues

1. **3D Viewer Not Loading**
   - Check browser console for errors
   - Verify Three.js is properly loaded
   - Clear browser cache

2. **YAML Generation Fails**
   - Validate form inputs
   - Check for required fields
   - Verify YAML.js is loaded

3. **Performance Issues**
   - Reduce model complexity
   - Disable real-time updates
   - Use simplified materials

### Debug Mode

Enable debug mode by adding `?debug=true` to the URL:

```
http://localhost:8000/index.html?debug=true
```

This will show additional information and enable developer tools. 